---
/**
 * RelatedServers Component - Display related servers in sidebar
 */
import { formatStars } from '../utils/serverData.js';
import { slugify } from '../utils/slugify.js';

interface MCPServer {
  id: string;
  slug?: string;
  fields: {
    name: string;
    description: string;
    stars?: number;
    category?: string;
  };
}

interface Props {
  servers: MCPServer[];
  currentServerId: string;
}

const { servers, currentServerId } = Astro.props;

// Filter out current server and limit to 5
const relatedServers = servers
  .filter(s => s.id !== currentServerId)
  .slice(0, 5);

const hasRelated = relatedServers.length > 0;
---

{hasRelated && (
  <section class="related-section">
    <h3 class="related-title">Related Servers</h3>
    
    <div class="related-list">
      {relatedServers.map(server => {
        const serverSlug = server.slug || slugify(server.fields.name);
        return (
          <a href={`/server/${serverSlug}`} class="related-item">
            <div class="related-icon">
              {server.fields.name.charAt(0).toUpperCase()}
            </div>
            <div class="related-info">
              <h4 class="related-name">{server.fields.name}</h4>
              <p class="related-description">
                {server.fields.description.length > 60 
                  ? server.fields.description.substring(0, 60) + '...' 
                  : server.fields.description}
              </p>
              {server.fields.stars && server.fields.stars > 0 && (
                <span class="related-stars">
                  <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                  </svg>
                  {formatStars(server.fields.stars)}
                </span>
              )}
            </div>
          </a>
        );
      })}
    </div>
  </section>
)}

<style>
  .related-section {
    background: hsl(var(--card));
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid hsl(var(--border));
    margin-top: 1.5rem;
  }

  .related-title {
    font-size: 0.85rem;
    font-weight: 600;
    color: hsl(var(--muted-foreground));
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin: 0 0 1rem 0;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid hsl(var(--border));
  }

  .related-list {
    display: grid;
    gap: 0.75rem;
  }

  .related-item {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 0.75rem;
    background: hsl(var(--muted));
    border-radius: 8px;
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .related-item:hover {
    background: hsl(var(--muted) / 0.8);
    transform: translateX(4px);
  }

  .related-icon {
    width: 36px;
    height: 36px;
    background: linear-gradient(135deg, hsl(var(--primary)) 0%, hsl(var(--secondary)) 100%);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 0.9rem;
    flex-shrink: 0;
  }

  .related-info {
    flex: 1;
    min-width: 0;
  }

  .related-name {
    font-size: 0.9rem;
    font-weight: 600;
    color: hsl(var(--foreground));
    margin: 0 0 0.25rem 0;
    line-height: 1.3;
  }

  .related-description {
    font-size: 0.8rem;
    color: hsl(var(--muted-foreground));
    margin: 0 0 0.35rem 0;
    line-height: 1.4;
  }

  .related-stars {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    font-size: 0.75rem;
    color: hsl(var(--primary));
    font-weight: 500;
  }

  .related-stars svg {
    color: hsl(var(--primary));
  }

  @media (max-width: 768px) {
    .related-section {
      padding: 1rem;
    }

    .related-item {
      padding: 0.6rem;
    }
  }
</style>
